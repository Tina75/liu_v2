<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>用户列表</title>
    <link href="css/bootstrap.css" rel="stylesheet">
    <link rel="stylesheet" href="css/common.css">
    <link rel="stylesheet" href="css/font-awesome.css">
    <link rel="stylesheet" href="css/font.css">
    <link rel="stylesheet" href="css/animate.css">
</head>
<body class=" animated fadeInRight">
<div class="container-fluid" id="example">
    <!--页签-->
    <!-- Nav tabs -->
    <ul class="nav nav-tabs">
        <li :class="{active:currentIndex == 0}"><a href="javascript:void(0)" @click.prevent="currentIndex=0" >用户列表</a></li>
        <li v-for="(item,index) in navLI_1" :class="{'active':currentIndex==index+1}">
            <a href="javascript:void(0)" @click.prevent.stop="demoClickLi(index+1)" >新建用户
                <span class="fa fa-close tabClose" @click.prevent.stop="tabClose(index+1)"></span>
            </a>
        </li>
        <li><span class="fa fa-plus add" @click="add($event.target)"></span></li>
    </ul>

    <!-- Tab panes -->
    <div class="tab-content">
        <div class="tab-pane" :class="{active:currentIndex == 0}"  >
            <div class="search clearfix">
                <div class="form-inline pull-left searchItems">
                    <div class="form-group">
                        <label for="task">用户名称:</label>
                        <input type="text" class="form-control" id="task" @keyup="cartView(1)" placeholder="请输入关键字" v-model.trim="userNameFilter" @keyup.enter="cartView(1)">
                    </div>
                    <button type="button" class="btn btn-primary" @click="cartView(1)">确认</button>
                </div>
                <div class="searchEdit pull-right">
                    <ul class="clearfix">
                        <li class="pull-right" @click="deleteList" >
                            <span class="icon-icon-sy7" :class="{active: selected.length>0}" >删除</span>
                        </li>
                        <li class="pull-right" @click="editPop">
                            <span class="icon-icon-sy8" :class="{active: selected.length==1}">编辑</span>
                        </li>
                        <li class="pull-right" @click="changeType('open')">
                            <span class="icon-icon-sy23" :class="{active: selected.length>0}">启用</span>
                        </li>
                        <li class="pull-right" @click="changeType('close')">
                            <span class="icon-icon-sy24" :class="{active: selected.length>0}">禁用</span>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="tableContainer">
                <div class="table-responsive" style="overflow-x: visible">
                    <table class="table">
                        <thead>
                        <tr>
                            <th style="width: 45px">
                                <div  class="item-check-btn" :class="{'check':checkAll}"  @click="isAll()">
                                    <span class="fa fa-check ok"></span>
                                </div>
                            </th>
                            <th>编号</th>
                            <th>用户名</th>
                            <th>手机</th>
                            <th>邮箱</th>
                            <th>角色</th>
                            <th @click="sort" style="cursor: pointer">创建时间<span class="fa" :class="sortClass"></span></th>
                            <th >组名称</th>
                            <th>状态</th>
                        </tr>
                        </thead>
                        <tbody>
                        <tr v-for="(item,index) in list">
                            <td>
                                <div  class="item-check-btn" :class="{'check':item.checked}" @click="selectedList(item)" >
                                    <span class="fa fa-check ok"></span>
                                </div>
                            </td>
                            <td>{{index+1}}</td>
                            <td>{{item.userName}}</td>
                            <td>{{item.phoneNum}}</td>
                            <td>{{item.email}}</td>
                            <td v-if="item.role == 0">管理员</td>
                            <td v-else="item.role == 1">普通用户</td>
                            <td>{{item.createTime}}</td>
                            <td class="dropdown" style="overflow: visible;">
                                <div v-if="item.userGroupInfoList.length!=0">
                                    <span class=" dropdown-toggle" data-toggle="dropdown" :class="{detail:item.userGroupInfoList.length!=1}">
                                        {{item.userGroupInfoList[0].groupName}}
                                        <span v-if="item.userGroupInfoList.length!=1" class="fa fa-eye"></span>
                                    </span>
                                    <ul class="dropdown-menu" style="font-size: inherit" v-if="item.userGroupInfoList.length!=1">
                                        <li v-for="inner in item.userGroupInfoList">{{inner.groupName}}</li>
                                    </ul>
                                </div>
                            </td>
                            <td v-if="item.onDisabled == 1">启用</td>
                            <td v-else="item.onDisabled == 2">禁用</td>
                        </tr>
                        </tbody>
                    </table>
                </div>
                <div class="page clearfix" >
                    <div class="pageCut">
                        每页
                        <select name="" class="form-control pageSelect" v-model="pageSize" @change="jumpPage(1)">
                            <option value="8">8</option>
                            <option value="10">10</option>
                            <option value="12">12</option>
                            <option value="14">14</option>
                            <option value="16">16</option>
                        </select>
                        条记录
                    </div>
                    <div class="pagelist" >
                        <!--<span class="jump" :class="{disabled:pstart}" @click="{current_page&#45;&#45;}"><</span>-->
                        <span v-show="current_page>5" class="jump" @click="jumpPage(1)">首页</span>
                        <span class="ellipsis" v-show="efont">...</span>
                        <span class="jump" v-for="num in indexs" :class="{bgprimary:current_page==num}"
                              @click="jumpPage(num)">{{num}}</span>
                        <span class="ellipsis" v-show="ebehind">...</span>

                        <!--<span :class="{disabled:pend}" @click="{current_page++}" class="jump">></span>-->
                        <span v-show="current_page<pages-4" class="jump" @click="jumpPage(pages)">尾页</span>

                        <span class="jumppoint">跳转到：</span>
                        <span class="jumpinp"><input type="text" v-model="changePage" @keyup.enter="jumpPage(changePage)"></span>
                        <span class="jump gobtn" @click="jumpPage(changePage)" >GO</span>
                    </div>
                </div>
            </div>
        </div>
        <!--新建任务-->
        <!--<transition-group-->
                <!--name="custom-classes-transition"-->
                <!--enter-active-class="animated rotateInUpLeft"-->
        <!--&gt;-->
            <div v-if="navLI_1.length!=0"  v-for="(item,index) in navLI_1" v-show="currentIndex==index+1" :key="index"   :class="{'active':currentIndex==index+1}" >
                <div class="add-target" >
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label  class="bold"><span style="color: red">*</span>用户名:</label>
                                    <input v-model.lazy="item.userName"  @blur="vailusername($event.target,item)"  type="text" class="form-control validate"  placeholder="在此输入内容...">
                                    <span class="form-account-error">支持中文、字母、数字、"-"、"_"的组合，1-20个字符</span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <div  class="bold">组:</div>
                                    <div  class="group_name">
                                        <div class="name_checked clearfix" @click=" item.groupIdStr.isShow = !item.groupIdStr.isShow;">
                                            <span class="pull-left" v-show="item.groupIdStr.groupObj.length == 0">选择组</span>
                                            <div class="checkedItem pull-left" v-show="item.groupIdStr.groupObj.length != 0">
                                                <span  v-for="name in item.groupIdStr.groupObj">{{name.groupName}}，</span>
                                            </div>
                                            <i class="fa  pull-right"  :class="{'fa-angle-up':item.groupIdStr.isShow,'fa-angle-down':!item.groupIdStr.isShow}"></i>
                                        </div>
                                        <transition  enter-active-class="animated slideInDown"
                                                    leave-active-class="animated slideOutUp">
                                            <div v-show="item.groupIdStr.isShow" class="nocheck" v-if="queryGroupList.length!=0">
                                                <div class="name_nocheck" >
                                                    <label class="checkbox-inline" :title="i.groupName" v-for="i in queryGroupList" v-if="queryGroupList.length!=0">
                                                        <input v-model="item.groupIdStr.groupObj"  type="checkbox"  :value="i" > {{i.groupName}}
                                                    </label>
                                                </div>
                                                <div class="checkBtn">
                                                    <span @click=" item.groupIdStr.isShow = false">确定</span>
                                                    <span @click=" item.groupIdStr.groupObj = queryGroupList">全选</span>
                                                    <span @click=" item.groupIdStr.groupObj = []">取消全选</span>
                                                </div>
                                            </div>
                                        </transition>
                                    </div>
                                </div>
                            </div>

                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label  class="bold"><span style="color: red">*</span>密码:</label>
                                    <input v-model="item.password" autocomplete="off" type="password" @blur="vailPwd($event.target,item)"  class="form-control validate"  placeholder="在此输入内容...">
                                    <span class="form-account-error">长度只能在6-20个字符之间</span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label  class="bold"><span style="color: red">*</span>确认密码:</label>
                                    <input v-model="item.cPassword" autocomplete="off" type="password" @blur="vailPwdC($event.target,item)"  class="form-control validate"  placeholder="在此输入内容...">
                                    <span class="form-account-error"></span>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label  class="bold">邮箱:</label>
                                    <input v-model="item.email" @blur="vailEmail($event.target,item)"  type="email" class="form-control validate"  placeholder="在此输入内容...">
                                    <span class="form-account-error"></span>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label  class="bold">手机:</label>
                                    <input v-model="item.phoneNum" @blur="vailPhone($event.target,item)" type="tel" class="form-control validate"  placeholder="在此输入内容...">
                                    <span class="form-account-error"></span>
                                </div>
                            </div>
                        </div>
                        <div class="row" style="margin-top:15px">
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label  class="bold">角色:</label>
                                    <select type="text" class="form-control" v-model="item.role">
                                        <option value="1">普通用户</option>
                                        <option value="0" >管理员</option>
                                    </select>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <div class="form-group">
                                    <label  class="bold">状态:</label>
                                    <select type="text" class="form-control" v-model="item.onDisabled">
                                        <option value="1" >启用</option>
                                        <option value="2" >禁用</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md-12 YoN_button" style="margin-top:30px">
                                <button class="y" @mousedown="addUser(item,index+1,$event.target)">确定</button>
                                <button class="n" @click="tabClose(index+1)">取消</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        <!--</transition-group>-->
    </div>

    <!--编辑弹框-->
    <div id="edit" style="display: none">
        <div class="add-target" v-if="JSON.stringify(editList)!='{}'">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label  class="bold"><span style="color: red">*</span>用户名:</label>
                            <input   type="text" @blur="vailusername($event.target,editList)" v-model="editList.userName" class="form-control"  placeholder="在此输入内容...">
                            <span class="form-account-error">支持中文、字母、数字、"-"、"_"的组合，1-20个字符</span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <div  class="bold">组:</div>
                            <div  class="group_name">
                                <div class="name_checked clearfix" @click="editList.isShow = !editList.isShow;">
                                    <span class="pull-left" v-show="editList.userGroupInfoList.length==0">选择组</span>
                                    <div class="checkedItem pull-left" v-show="editList.userGroupInfoList.length != 0">
                                        <span  v-for="name in editList.userGroupInfoList">{{name.groupName}}，</span>
                                    </div>
                                    <i class="fa  pull-right"  :class="{'fa-angle-up':editList.isShow,'fa-angle-down':!editList.isShow}"></i>
                                </div>
                                <transition  enter-active-class="animated slideInDown"
                                             leave-active-class="animated slideOutUp">
                                    <div v-show="editList.isShow" class="nocheck" v-if="queryGroupList.length!=0">
                                        <div class="name_nocheck" >
                                            <label class="checkbox-inline" :title="i.groupName" v-for="i in queryGroupList" v-if="queryGroupList.length!=0">
                                                <input v-model="editList.userGroupInfoList"  type="checkbox"  :value="i" > {{i.groupName}}
                                            </label>
                                        </div>
                                        <div class="checkBtn">
                                            <span @click=" editList.isShow = false">确定</span>
                                            <span @click=" editList.userGroupInfoList = queryGroupList">全选</span>
                                            <span @click=" editList.userGroupInfoList = []">取消全选</span>
                                        </div>
                                    </div>
                                </transition>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label  class="bold">邮箱:</label>
                            <input  type="email" @blur="vailEmail($event.target,editList)" v-model="editList.email" class="form-control"  placeholder="在此输入内容...">
                            <span class="form-account-error"></span>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label  class="bold">手机:</label>
                            <input type="tel" @blur="vailPhone($event.target,editList)" v-model="editList.phoneNum" class="form-control"  placeholder="在此输入内容...">
                            <span class="form-account-error"></span>
                        </div>
                    </div>
                </div>
                <div class="row" style="margin-top:15px">
                    <div class="col-md-6">
                        <div class="form-group">
                            <label  class="bold">角色:</label>
                            <select type="text" class="form-control" v-model="editList.role">
                                <option value="1">普通用户</option>
                                <option value="0" >管理员</option>
                            </select>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group">
                            <label  class="bold">状态:</label>
                            <select type="text" class="form-control" v-model="editList.onDisabled">
                                <option value="1" >启用</option>
                                <option value="2" >禁用</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

</body>
<script src="js/jquery.min.js"></script>
<script src="js/layer/layer.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/vue.js"></script>
<script src="js/ajaxMy.js"></script>
<script src="js/url.js"></script>
<script>
    // 创建根实例
    new Vue({
        el: '#example',
        data: {
            list: [],   //展示数组
            sortFlag:undefined, //默认升序
            userNameFilter:'', //搜索项
            current_page: 1, //当前页
            pageSize:8,  //每页数据条数
            pages: 0, //总页数
            changePage:'',//跳转页
            checkAll:false,
            navLI:[{}],
            currentIndex:0,
            queryGroupList:[], //获取用户分组列表（下拉列表数据）
            editList:{},    //编辑弹框显示内容
            selected:[]    //选中项
        },
        mounted: function () {
            var _this = this;
            this.$nextTick(function () {
                _this.cartView(_this.current_page);
                _this.queryGroup();
            })
        },
        computed:{
            show:function(){
                return this.pages && this.pages !=1
            },
            pstart: function() {
                return this.current_page == 1;
            },
            pend: function() {
                return this.current_page == this.pages;
            },
            efont: function() {
                if (this.pages <= 7) return false;
                return this.current_page > 5
            },
            ebehind: function() {
                if (this.pages <= 7) return false;
                var nowAy = this.indexs;
                return nowAy[nowAy.length - 1] != this.pages;
            },
            indexs: function() {

                var left = 1,
                    right = this.pages,
                    ar = [];
                if (this.pages >= 7) {
                    if (this.current_page > 5 && this.current_page < this.pages - 4) {
                        left = Number(this.current_page) - 3;
                        right = Number(this.current_page) + 3;
                    } else {
                        if (this.current_page <= 5) {
                            left = 1;
                            right = 7;
                        } else {
                            right = this.pages;

                            left = this.pages - 6;
                        }
                    }
                }
                while (left <= right) {
                    ar.push(left);
                    left++;
                }
                return ar;
            },
            navLI_1:function () {
                return this.navLI.slice(1);
            },
            sortClass:function () {
                var s = this.sortFlag;
                //console.log((typeof s == "undefined") ? "fa-sort" : (s == true?"fa-sort-asc":"fa-sort-desc"));
                return (typeof s == "undefined") ? "fa-sort" : (s == true?"fa-sort-asc":"fa-sort-desc")
            }
        },
        methods: {
            cartView: function (cPage) {
                var _this = this;
                //模拟数据
                var u = url +"user/queryUserList/"+cPage+"/"+this.pageSize+"?userNameFilter="+encodeURIComponent(this.userNameFilter);
                ajaxGet(u,function (data) {
                    if(data.resultCode == ERR_OK ){
                        _this.list = data.data.userList;
                        _this.pages = parseInt(data.data.countPage);
//                        if(_this.current_page>_this.pages){
//                            _this.current_page = _this.pages;
//                        }
                    }else{
                        layer.alert("数据请求失败");
                    }
                });
            },
            sort:function () {
                if(typeof this.sortFlag == "undefined"){
                    this.sortFlag=true;
                }else{
                    this.sortFlag=!this.sortFlag;
                }
                if(this.sortFlag){ //true 升序
                    this.list.sort(compare_asc("createTime"));
                }else{
                    this.list.sort(compare_des("createTime"));
                }
            },
            selectedList: function (item) {
                var _this=this;
                if (typeof item.checked == "undefined") {
                    // Vue.set(item,"checked",true);
                    this.$set(item, "checked", true);
                } else {
                    item.checked = !item.checked;
                }
                this.isCheckAll();
                //复选框选中项
                _this.selected = [];
                this.list.forEach(function (item) {
                    if(item.checked){
                        _this.selected.push(item);
                    }
                });
            },
            isAll: function () {  //全选
                var _this = this;
                this.checkAll=!this.checkAll;
                _this.list.forEach(function (item) {
                    if (typeof item.checked == "undefined") {
                        _this.$set(item, "checked", _this.checkAll);
                    } else {
                        item.checked = _this.checkAll;
                    }
                });
                //复选框选中项
                _this.selected = [];
                this.list.forEach(function (item) {
                    if(item.checked){
                        _this.selected.push(item);
                    }
                });
            },
            isCheckAll: function () {
                var flag = true;
                this.list.forEach(function (item) {
                    if(!item.checked){
                        flag = false;
                    }
                })
                if(flag){
                    this.checkAll = true;
                }else{
                    this.checkAll = false;
                }

            },
            jumpPage: function(id) {
                if(id <=this.pages){
                    this.current_page = id;
                    this.cartView(this.current_page);
                }else{
                    layer.alert("超出最大页数")
                }

            },
            add:function (dom) {
                var index = $(dom).parent().index(".nav-tabs li");
                //this.group_name.push([]);
                this.navLI.push({
                    'userName':'',
                    'groupIdStr':{'groupObj':[],isShow:false},
                    'password':'',
                    'cPassword':'',
                    'email':'',
                    'phoneNum':'',
                    'role':1,
                    'onDisabled':1,
                    'isOk':{userName:false,password:false,cPassword:false,email:false,phoneNum:false}
                });
                this.currentIndex = index;
            },
            tabClose:function (index) {
                if(this.navLI.length>1){
                    this.navLI.splice(index,1);
                    if(this.currentIndex == index){ //当前为激活状态,关闭后选择前一个标签
                        this.currentIndex = index-1;
                    }else if(this.currentIndex > index){  //选择后前一个tab
                        this.currentIndex--;
                    }
                }

            },
            demoClickLi:function(index) {
                this.currentIndex = index;
                return false;
            },
            queryGroup:function () { //获取用户分组列表（下拉列表数据）
                var _this = this;
                //模拟数据
                var u = url +"user/queryGroupList";
                ajaxGet(u,function (data) {
                    if(data.resultCode == ERR_OK ){
                        _this.queryGroupList = data.data;
                        console.log(_this.queryGroupList );
                    }else{
                        layer.alert("数据请求失败");
                    }
                });
            },
            addUser:function (item,index,dom) {
                console.log(dom)
                var _this = this;
                var u = url +'user/addUser';
                var groupIdStr = '';
                item.groupIdStr.groupObj.forEach(function (v,i,array) {
                   groupIdStr += v.groupId + ",";
                });
                groupIdStr=groupIdStr.slice(0,-1);
                var user = {
                    "email": item.email,
                    "groupIdStr": groupIdStr,
                    "md5_pwd": item.password,
                    "phoneNum": item.phoneNum,
                    "role": item.role,//管理员：0；1：普通用户
                    "userName":item.userName,
                    "onDisabled":item.onDisabled//启用：1；禁用：2
                };
                //模拟失去焦点
                var input = $(dom).parent().parent().parent().find(".validate");
                for(var i = 0; i < input.length; i++){
                    $(input[i]).trigger('focus');
                    $(input[i]).trigger('blur');
                }
                var isOk = item.isOk.userName&&item.isOk.password&&item.isOk.cPassword&&item.isOk.email&&item.isOk.phoneNum;
                if(isOk){
                    ajaxPostObj(u,JSON.stringify(user),function (data) {
                        if(data.resultCode == ERR_OK ){
                            layer.alert("添加成功",function (i) {
                                _this.cartView(_this.current_page);
                                _this.tabClose(index);
                                layer.close(i);
                            })
                        }else{
                            layer.alert(data.message);
                        }
                    })
                }
            },
            vailEmail:function (dom,item) {
                var email = item.email;
                var span = dom.nextElementSibling;
                if(email==""){
                    item.isOk.email = true;
                    this.valiWays(span,"",true);
                    return;
                }
                if(/^(\w-*\.*)+@(\w-?)+(\.\w{2,})+$/.test(email)){
                    item.isOk.email = true;
                    this.valiWays(span,"",true);
                    return;
                }else{
                    item.isOk.email = false;
                    this.valiWays(span,"邮箱格式错误",false);
                    return;
                }

            },
            vailPhone:function (dom,item) {
                var phoneNum = item.phoneNum;
                var span = dom.nextElementSibling;
                if(phoneNum==""){
                    item.isOk.phoneNum = true;
                    this.valiWays(span,"",true);
                    return;
                }
                if(/^1\d{10}$/.test(phoneNum)){
                    item.isOk.phoneNum = true;
                    this.valiWays(span,"",true);
                    return;
                }else{
                    item.isOk.phoneNum = false;
                    this.valiWays(span,"手机号码格式错误",false);
                    return;
                }

            },
            vailusername:function (dom,item) {
                var userName = item.userName;
                console.log(userName)
                var span = dom.nextElementSibling;
                if(userName==""){
                    item.isOk.userName = false;
                    this.valiWays(span,"用户名不能为空",false);
                    return;
                }
                if(userName.length>20){
                    item.isOk.userName = false;
                    this.valiWays(span,"长度只能在20个字符之间",false);
                    return;
                }
               if(/^[a-zA-Z0-9\u4e00-\u9fa5_-]{1,20}$/.test(userName)){
                   item.isOk.userName = true;
                   this.valiWays(span,"",true);
                   return;
               }else{
                   item.isOk.userName = false;
                   this.valiWays(span,"格式错误，仅支持汉字、字母、数字、“-”“_”的组合",false);
                   return;
               }

            },
            vailPwd:function (dom,item) {
                var password = item.password;
                var span = dom.nextElementSibling;
                if(password==""){
                    item.isOk.password = false;
                    this.valiWays(span,"密码不能为空",false);
                    return;
                }
                if(password.length>5 && password.length<21){
                    item.isOk.password = true;
                    this.valiWays(span,"",true);
                    return;
                }else{
                    item.isOk.password = false;
                    this.valiWays(span,"长度只能在6-20个字符之间",false);
                    return;
                }

            },
            vailPwdC:function (dom,item) {
                var password = item.password;
                var cPassword = item.cPassword;
                var span = dom.nextElementSibling;
                if(password == cPassword){
                    item.isOk.cPassword = true;
                    this.valiWays(span,"",true);
                    return;
                }else{
                    item.isOk.cPassword = false;
                    this.valiWays(span,"两次密码输入不一致",false);
                    return;
                }

            },
            valiWays:function (span,str,flag) {
                span.innerHTML = str;
                if(flag){
                    removeClass(span.parentElement, "error")
                }else{ //增加error
                    addClass( span.parentElement, "error")
                }

            },
            deleteList:function () {
                var _this=this;
                var userIdList = [];
                this.selected.forEach(function (item) {
                    userIdList.push(item.userId);
                });
                if(userIdList.length>0){
                    layer.confirm('您确定要删除吗？', {
                        btn: ['确定','取消'] //按钮
                    }, function(){
                        ajaxGetArray(url+"user/deleteUserInfoByUserId",{userIdList:userIdList},function (data) {
                            if(data.resultCode == ERR_OK ){
                                var index=layer.alert("删除成功",function () {
                                    _this.cartView(_this.current_page);
                                    _this.selected = [];
                                    _this.checkAll = false;
                                    layer.close(index);
                                });

                            }else{
                                layer.alert("删除失败");
                            }
                        });
                    }, function(){
                        layer.closeAll();
                    });
                }else{
                    return
                }
            },
            editPop:function () {
                var arr = [];
                var _this = this;
                this.selected.forEach(function (item) {
                    arr.push(item);
                });
                if(arr.length==1){
                    _this.editList = arr[0];
                    this.$set(_this.editList, "isShow", false);
                    this.$set(_this.editList, "isOk", {userName:false,email:false,phoneNum:false});
                    console.log(_this.editList);
                    layer.open({
                        type: 1,
                        title: ['详情'],
                        closeBtn: 1,
                        btn:['确定','关闭'],
                        btnAlign: 'c',
                        area: ['800px', '400px'],
                        //skin: 'detailPop', //没有背景色
                        shadeClose: true,
                        content: $('#edit'),
                        yes:function () {
                            _this.edit();
                        }
                    });
                }else{
                    return;
                }
            },
            edit:function () {
                var _this=this;
                var u = url+"user/editeUserInfoByUserId/"+this.editList.userId;
                var groupIdStr = '';
                this.editList.userGroupInfoList.forEach(function (v,i,array) {
                    groupIdStr += v.groupId + ",";
                });
                groupIdStr=groupIdStr.slice(0,-1);
                var user = {
                    "email": this.editList.email,
                    "groupIdStr": groupIdStr,
                    "phoneNum": this.editList.phoneNum,
                    "role": this.editList.role,//管理员：0；1：普通用户
                    "userName":this.editList.userName,
                    "onDisabled":this.editList.onDisabled//启用：1；禁用：2
                };
                ajaxPostObj(u,JSON.stringify(user),function (data) {
                    if(data.resultCode == ERR_OK ){
                        layer.alert("修改成功",function () {
                            _this.cartView(_this.current_page);
                            _this.selected = [];
                            layer.closeAll();
                        });
                    }else{
                        layer.alert(data.message);
                    }
                });
            },
            changeType:function (type) { //启用或者禁用判断能否进行//启用：1；禁用：2
                var isChange = false;
                if(type == "open"){
                    for(var i = 0;i < this.selected.length; i++){
                        if(this.selected[i].onDisabled == 1){
                            isChange = false;
                            layer.alert("启用的不能再次启用");
                            return false;
                        }
                    }
                }else{
                    for(var i = 0;i < this.selected.length; i++){
                        console.log(this.selected[i].onDisabled )
                        if(this.selected[i].onDisabled == 2){
                            isChange = false;
                            layer.alert("禁用的不能再次禁用");
                            return false;
                        }
                    }
                }
                //修改启用禁用状态
                this.changeState(type);
            },
            changeState:function (type) {
                var _this = this;
                var u = url +"user/changeUserStateByUserId/"+type;
                var userIdList = [];
                this.selected.forEach(function (v,i,array) {
                    userIdList.push(v.userId);
                });
                ajaxGetArray(u,{userIdList:userIdList},function (data) {
                    if(data.resultCode == ERR_OK ){
                        var index=layer.alert("更新用户状态成功！",function (i) {
                            _this.cartView(_this.current_page);
                            _this.selected = [];
                            _this.checkAll = false;
                            _this.tabClose(index);
                            layer.close(i);
                        })
                    }else{
                        layer.alert(data.message);
                    }
                })
            }
        }
    })
</script>
</html>